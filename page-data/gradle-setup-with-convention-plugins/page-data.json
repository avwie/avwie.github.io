{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/gradle-setup-with-convention-plugins",
    "result": {"data":{"markdown":{"html":"<p>I try to experiment a lot in Kotlin because I love the language so much. Since I like to use different features for different experiments, I normally just made a new project for every experiment and placed it under a root project. But since Kotlin uses Gradle I noticed that I really hated starting a new project. Mind you, this is not due to Gradle per se, but more my inability to understand Gradle. Gradle is just a very complicated tool. For basic use-cases it is quite simple, but when you work with beta-Compose libraries, different plugins and what not it becomes a bit of a hassle. At least for me. And I sometimes spent quite some time setting up a new project just for experimentation.</p>\n<p>Since it was hampering my creativity I decided to find out if I can make my life a bit easier. Since I figured my use-case is not unique at all, I decided to ask in the Kotlin Slack channel if there is a way to make my life easier. To have something that does this:</p>\n<ul>\n<li>Initialize all required repositories</li>\n<li>Install necessary Kotlin compiler plugins (serialization, Compose)</li>\n<li>Setup a basic multiplatform project with JS and JVM targets</li>\n<li>Add my most used dependencies</li>\n<li>Have a centralized way of managing versioning</li>\n</ul>\n<h2 id=\"version-catalogs\">Version catalogs</h2>\n<p>As a response I got that for versioning the preferred way is: <a href=\"https://docs.gradle.org/current/userguide/platforms.html\">version catalogs</a>. And the most notable here is the versioning via a <a href=\"https://docs.gradle.org/current/userguide/platforms.html#sub::toml-dependencies-format\">libs.versions.toml</a> file which needs to be placed in the root <code class=\"language-text\">gradle</code> folder.</p>\n<p>This <code class=\"language-text\">libs.versions.toml</code> file will be automatically compiled to Java code, for the Gradle build only, not for your actual program code, so you can access it in a typesafe way in your Gradle scripts.</p>\n<p>So as an example, I create the following <code class=\"language-text\">libs.versions.toml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token punctuation\">[</span><span class=\"token table class-name\">versions</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">jetbrains-datetime</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"0.4.0\"</span>\n<span class=\"token key property\">jetbrains-serialization-json</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"1.4.1\"</span>\n<span class=\"token key property\">jetbrains-collections-immutable</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"0.3.5\"</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token table class-name\">libraries</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">jetbrains-datetime</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token key property\">module</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"org.jetbrains.kotlinx:kotlinx-datetime\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">version.ref</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"jetbrains-datetime\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token key property\">jetbrains-serialization-json</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token key property\">module</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"org.jetbrains.kotlinx:kotlinx-serialization-json\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">version.ref</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"jetbrains-serialization-json\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token key property\">jetbrains-collections-immutable</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token key property\">module</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"org.jetbrains.kotlinx:kotlinx-collections-immutable\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">version.ref</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"jetbrains-collections-immutable\"</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>then, in my <code class=\"language-text\">build.gradle.kts</code> I can just say:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">dependencies <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>libs<span class=\"token punctuation\">.</span>jetbrains<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>libs<span class=\"token punctuation\">.</span>jetbrains<span class=\"token punctuation\">.</span>serialization<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>libs<span class=\"token punctuation\">.</span>jetbrains<span class=\"token punctuation\">.</span>collections<span class=\"token punctuation\">.</span>immutable<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"convention-plugins\">Convention Plugins</h2>\n<p>What still remains is basically a way to configure a project automatically via a plugin. Well, apparently <a href=\"https://docs.gradle.org/current/samples/sample_convention_plugins.html\">convention plugins</a> are the way to go! There is an Android project that follows quite some best practices, called <a href=\"https://github.com/android/nowinandroid/tree/main/build-logic\">Now in Android</a>, that has this implemented on a larger scale.</p>\n<p>A convention plugin is a Kotlin script, ending in <code class=\"language-text\">&lt;plugin-name>.gradle.kts</code> that is precompiled before actually other Gradle projects are loaded. So you can actually load these precompiled plugins using <code class=\"language-text\">id(&lt;plugin-name>)</code> in your 'normal' Gradle projects and have them execute. These convention plugin scripts are nothing more than normal <code class=\"language-text\">build.gradle.kts</code> scripts. So you can just do exactly the same.</p>\n<p>However, there are some caveats....of course.</p>\n<p>Since it is precompiled, before the other Gradle stuff runs, you can't use some normal Gradle build script things you expect to have. So the version catalogs can't be used with the typesafe API. Luckily we can still use a non-typesafe way. Besides that, any plugin you require <em>in</em> your precompiled build-script needs to be added as an <code class=\"language-text\">implementation</code> dependency in the <code class=\"language-text\">build.gradle.kts</code> of the project where the plugins are defined.</p>\n<p>This sounds all mightely confusing, so better to just start.</p>\n<h2 id=\"basic-project-setup\">Basic project setup</h2>\n<p>I make a new root project that will contain projects with my own written libraries, as well projects with my experiments/examples and a project which contains the convention plugins. I call the project <code class=\"language-text\">nl.avwie.kotlinx</code> and this is the basic folder structure</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kotlinx\n  |- plugins\n     |- build.gradle.kts\n     |- settings.gradle.kts\n  |- demos\n  |- gradle/libs.versions.toml\n  |- libraries\n  |- build.gradle.kts\n  |- settings.gradle.kts</code></pre></div>\n<h3 id=\"root-project\">Root project</h3>\n<h4 id=\"the-code-classlanguage-textsettingsgradlektscode-file\">The <code class=\"language-text\">settings.gradle.kts</code> file</h4>\n<p>The <code class=\"language-text\">settings.gradle.kts</code> file is our top-level settings file that will define some settings for all our underlying project. Basically it consists of nothing more than:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/settings.gradle.kts</span>\nrootProject<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"kotlinx\"</span></span>\n\n<span class=\"token function\">includeBuild</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"plugins\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This settings file indicates that the <code class=\"language-text\">plugins</code> subproject needs to be added to the so called <em>composite</em> build of the Gradle project. It will be build before any of the other projects that will be included using the regular <code class=\"language-text\">include</code>. This makes sense since it will contain plugins that need to be compiled before they can be used in the future subprojects.</p>\n<h4 id=\"the-code-classlanguage-textbuildgradlektscode-file\">The <code class=\"language-text\">build.gradle.kts</code> file</h4>\n<p>This file will contain any high level build information:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/build.gradle.kts</span>\nsubprojects <span class=\"token punctuation\">{</span>\n    group <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"nl.avwie.kotlinx\"</span></span>\n    version <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"1.0.0-SNAPSHOT\"</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This way we have a centralized way of defining the versioning of any libraries we might publish. This might make absolutely no sense if you want to publish separate libraries. In that case just manage it in the respective build files of the subprojects themselves.</p>\n<h3 id=\"the-plugins\">The plugins</h3>\n<p>Now on to the interesting part of actually making some precompiled script plugins. I want to have the following capabilities exposed as plugins:</p>\n<ul>\n<li>a plugin that defines my standard repositories, including my own Space repository</li>\n<li>a plugin that defines publishing to my own Space repository</li>\n<li>a plugin that sets up a default multiplatform library project with proper repositories and publishing</li>\n<li>a plugin that sets up a default multiplatform Jetbrains Compose project with proper repositories and publishing</li>\n<li>a plugin that sets up a default multiplatforn starter project with sensible defaults dependencies I use a lot</li>\n<li>a plugin that sets up a default multiplatforn starter Jetbrains Compose project with sensible defaults dependencies I use a lot</li>\n</ul>\n<h4 id=\"the-plugin-build\">The plugin build</h4>\n<p>The plugin project requires some setting up, because that is build before anything else and as such needs some dependencies and configuration in order for it to be built correctly.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/plugins/settings.gradle.kts</span>\ndependencyResolutionManagement <span class=\"token punctuation\">{</span>\n    repositories <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">mavenCentral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">maven</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"https://maven.pkg.jetbrains.space/public/p/compose/dev\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    versionCatalogs <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"libs\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token function\">files</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"../gradle/libs.versions.toml\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see we activate the <code class=\"language-text\">versionCatalogs</code> so we can use it also in the plugin files.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/plugins/build.gradle.kts</span>\nplugins <span class=\"token punctuation\">{</span>\n    `kotlin<span class=\"token operator\">-</span>dsl`\n<span class=\"token punctuation\">}</span>\n\ndependencies <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>libs<span class=\"token punctuation\">.</span>gradle<span class=\"token punctuation\">.</span>plugin<span class=\"token punctuation\">.</span>jetbrains<span class=\"token punctuation\">.</span>kotlin<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>libs<span class=\"token punctuation\">.</span>gradle<span class=\"token punctuation\">.</span>plugin<span class=\"token punctuation\">.</span>jetbrains<span class=\"token punctuation\">.</span>serialization<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>libs<span class=\"token punctuation\">.</span>gradle<span class=\"token punctuation\">.</span>plugin<span class=\"token punctuation\">.</span>jetbrains<span class=\"token punctuation\">.</span>compose<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We need the dependencies on the plugins here, because we need to apply them in the respective build scripts. Please note that this is different than normally refering to a plugin <code class=\"language-text\">id</code> in a normal build script.</p>\n<p>We need those dependencies in our <code class=\"language-text\">libs.versions.toml</code> of course:</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token punctuation\">[</span><span class=\"token table class-name\">libraries</span><span class=\"token punctuation\">]</span>\n// <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n// <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token comment\"># gradle plugins</span>\n<span class=\"token key property\">gradle-plugin-jetbrains-kotlin</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token key property\">module</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"org.jetbrains.kotlin:kotlin-gradle-plugin\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">version.ref</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"jetbrains-kotlin\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token key property\">gradle-plugin-jetbrains-serialization</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token key property\">module</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"org.jetbrains.kotlin:kotlin-serialization\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">version.ref</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"jetbrains-kotlin\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token key property\">gradle-plugin-jetbrains-compose</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token key property\">module</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"org.jetbrains.compose:compose-gradle-plugin\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">version.ref</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"jetbrains-compose\"</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"repositories-convention-plugin\">Repositories convention plugin</h4>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/plugins/src/main/kotlin/convention.repositories.gradle.kts</span>\n<span class=\"token keyword\">val</span> spaceUsername<span class=\"token operator\">:</span> String <span class=\"token keyword\">by</span> project\n<span class=\"token keyword\">val</span> spacePassword<span class=\"token operator\">:</span> String <span class=\"token keyword\">by</span> project\n\nrepositories <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">google</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">mavenCentral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">maven</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"https://maven.pkg.jetbrains.space/public/p/compose/dev\"</span></span><span class=\"token punctuation\">)</span>\n\n    maven <span class=\"token punctuation\">{</span>\n        url <span class=\"token operator\">=</span> <span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"&lt;REDACTED>\"</span></span><span class=\"token punctuation\">)</span>\n        credentials <span class=\"token punctuation\">{</span>\n            username <span class=\"token operator\">=</span> spaceUsername\n            password <span class=\"token operator\">=</span> spacePassword\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see this simply defines the repositories as you normally would in a normal project.</p>\n<h4 id=\"publishing-convention-plugin\">Publishing convention plugin</h4>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/plugins/src/main/kotlin/convention.publishing.gradle.kts</span>\n<span class=\"token keyword\">val</span> spaceUsername<span class=\"token operator\">:</span> String <span class=\"token keyword\">by</span> project\n<span class=\"token keyword\">val</span> spacePassword<span class=\"token operator\">:</span> String <span class=\"token keyword\">by</span> project\n\nplugins <span class=\"token punctuation\">{</span>\n    `maven<span class=\"token operator\">-</span>publish`\n<span class=\"token punctuation\">}</span>\n\npublishing <span class=\"token punctuation\">{</span>\n    repositories <span class=\"token punctuation\">{</span>\n        maven <span class=\"token punctuation\">{</span>\n            url <span class=\"token operator\">=</span> <span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"&lt;REDACTED>\"</span></span><span class=\"token punctuation\">)</span>\n            credentials <span class=\"token punctuation\">{</span>\n                username <span class=\"token operator\">=</span> spaceUsername\n                password <span class=\"token operator\">=</span> spacePassword\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"multiplatform-library-convention-plugin\">Multiplatform library convention plugin</h4>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/plugins/src/main/kotlin/convention.library-multiplatform.gradle.kts</span>\nplugins <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"convention.repositories\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"convention.publishing\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">kotlin</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"multiplatform\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nkotlin <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">js</span><span class=\"token punctuation\">(</span>IR<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">browser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">jvm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see we can refer to the other plugins we defined earlier.</p>\n<h4 id=\"multiplatform-compose-library-convention-plugin\">Multiplatform Compose library convention plugin</h4>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/plugins/src/main/kotlin/convention.library-multiplatform-compose.gradle.kts</span>\nplugins <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"convention.library-multiplatform\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// we basically extend this one</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"org.jetbrains.compose\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nkotlin <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">js</span><span class=\"token punctuation\">(</span>IR<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">browser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">jvm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    sourceSets <span class=\"token punctuation\">{</span>\n        <span class=\"token annotation builtin\">@Suppress</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"UNUSED_VARIABLE\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> commonMain <span class=\"token keyword\">by</span> getting <span class=\"token punctuation\">{</span>\n            dependencies <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>compose<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So far this all looks pretty straightforward! Let's look at a starter project:</p>\n<h4 id=\"multiplatform-starter-project\">Multiplatform starter project</h4>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/plugins/src/main/kotlin/starter.multiplatform.gradle.kts</span>\n\n<span class=\"token keyword\">val</span> versionCatalog <span class=\"token operator\">=</span> extensions<span class=\"token punctuation\">.</span>getByType<span class=\"token operator\">&lt;</span>VersionCatalogsExtension<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">named</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"libs\"</span></span><span class=\"token punctuation\">)</span>\n\nplugins <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"convention.repositories\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">kotlin</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"multiplatform\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">kotlin</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"plugin.serialization\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nkotlin <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">js</span><span class=\"token punctuation\">(</span>IR<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">browser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      binaries<span class=\"token punctuation\">.</span><span class=\"token function\">executable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  jvm <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">withJava</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n\n  <span class=\"token annotation builtin\">@Suppress</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"UNUSED_VARIABLE\"</span></span><span class=\"token punctuation\">)</span>\n  sourceSets <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">val</span> commonMain <span class=\"token keyword\">by</span> getting <span class=\"token punctuation\">{</span>\n          dependencies <span class=\"token punctuation\">{</span>\n              <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"jetbrains.coroutines.core\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n              <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"jetbrains.datetime\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n              <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"jetbrains.serialization.json\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n              <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"jetbrains.collections.immutable\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n              <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"uuid\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n              <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"kodein-di-core\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n              <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"flowext\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here you see we access the version catalog using the non-typesafe way. We apply the multiplatform and serialization plugins and add some libraries I use a <em>lot</em>.</p>\n<h4 id=\"multiplatform-compose-starter-plugin\">Multiplatform Compose starter plugin</h4>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/plugins/src/main/kotlin/starter.multiplatform-compose.gradle.kts</span>\n<span class=\"token keyword\">import</span> gradle<span class=\"token punctuation\">.</span>kotlin<span class=\"token punctuation\">.</span>dsl<span class=\"token punctuation\">.</span>accessors<span class=\"token punctuation\">.</span>_2ac8a54cb38e450fac76afa89d97da17<span class=\"token punctuation\">.</span>compose\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>gradle<span class=\"token punctuation\">.</span>kotlin<span class=\"token punctuation\">.</span>dsl<span class=\"token punctuation\">.</span>getValue\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>gradle<span class=\"token punctuation\">.</span>kotlin<span class=\"token punctuation\">.</span>dsl<span class=\"token punctuation\">.</span>getting\n\n<span class=\"token keyword\">val</span> versionCatalog <span class=\"token operator\">=</span> extensions<span class=\"token punctuation\">.</span>getByType<span class=\"token operator\">&lt;</span>VersionCatalogsExtension<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">named</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"libs\"</span></span><span class=\"token punctuation\">)</span>\n\nplugins <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"starter.multiplatform\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"org.jetbrains.compose\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nkotlin <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation builtin\">@Suppress</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"UNUSED_VARIABLE\"</span></span><span class=\"token punctuation\">)</span>\n    sourceSets <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> commonMain <span class=\"token keyword\">by</span> getting <span class=\"token punctuation\">{</span>\n            dependencies <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>compose<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">)</span>\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"kodein-di-compose\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">val</span> jvmMain <span class=\"token keyword\">by</span> getting <span class=\"token punctuation\">{</span>\n            dependencies <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>compose<span class=\"token punctuation\">.</span>desktop<span class=\"token punctuation\">.</span>currentOs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">exclude</span><span class=\"token punctuation\">(</span>group <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"org.jetbrains.compose.material\"</span></span><span class=\"token punctuation\">,</span> module <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"material\"</span></span><span class=\"token punctuation\">)</span>\n                    <span class=\"token function\">exclude</span><span class=\"token punctuation\">(</span>group <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"org.jetbrains.compose.material3\"</span></span><span class=\"token punctuation\">,</span> module <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"material3\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>versionCatalog<span class=\"token punctuation\">.</span><span class=\"token function\">findLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"jetbrains.coroutines.swing\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">val</span> jsMain <span class=\"token keyword\">by</span> getting <span class=\"token punctuation\">{</span>\n            dependencies <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>compose<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">)</span>\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>compose<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>svg<span class=\"token punctuation\">)</span>\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span>compose<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>These are all the plugins! </p>\n<h2 id=\"using-the-plugins\">Using the plugins</h2>\n<p>I am creating a very basic demo project where I simulate some bouncing balls by creating a project in <code class=\"language-text\">demos/simulation</code> and adding a <code class=\"language-text\">build.gradle.kts</code>. I include the project in the root <code class=\"language-text\">settings.gradle.kts</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/settings.gradle.kts</span>\nrootProject<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"kotlinx\"</span></span>\n\n<span class=\"token function\">includeBuild</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"plugins\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">include</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\":demos:simulation\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// &lt;root>/demos/simulation/build.gradle.kts</span>\nplugins <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"starter.multiplatform-compose\"</span></span><span class=\"token punctuation\">)</span>\n    `application`\n<span class=\"token punctuation\">}</span>\n\nkotlin <span class=\"token punctuation\">{</span>\n    sourceSets <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> commonMain <span class=\"token keyword\">by</span> getting <span class=\"token punctuation\">{</span>\n            dependencies <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span><span class=\"token function\">project</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\":libraries:ui\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n                <span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span><span class=\"token function\">project</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\":libraries:ui-compose\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\napplication <span class=\"token punctuation\">{</span>\n    mainClass<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"AppKt\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see I include the <code class=\"language-text\">starter.multiplatform-compose</code> plugin, and some minor additional stuff. And it just works! Easy-peasy setup for me to create simple demos in both JVM and JS.</p>\n<h2 id=\"acknowledgements\">Acknowledgements</h2>\n<p>I have to be fair, it took me a while to get here and I had to ask a <em>lot</em>, like really a <em>lot</em>, of questions in the Kotlin Slack channel. So most credits go out to the people there, and most notably:</p>\n<ul>\n<li>Adam S</li>\n<li>Björn Kautler</li>\n<li>PoisenedYouth</li>\n</ul>\n<p>So this blog post is more a culmination of them saying whay I should do. Nevertheless, other people might benefit.</p>\n<p>Adam S. also had some very specific notions on how to do this and this solution differs a lot. So I'd suggest to join the Kotlin Slack and ask in <code class=\"language-text\">#gradle</code> any specific questions.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>This was a very short blog post, more a brain-dump to be honest. However, I learned a lot again. The final code is be viewed here:</p>\n<p><a href=\"https://github.com/avwie/kotlinx/tree/blog/gradle-setup-with-convention-plugins\">https://github.com/avwie/kotlinx/tree/blog/gradle-setup-with-convention-plugins</a></p>","frontmatter":{"date":"03 Feb, 2023","slug":"/gradle-setup-with-convention-plugins","title":"Building a Gradle setup with convention plugins for quick Kotlin experiments","pageScripts":null}}},"pageContext":{"slug":"/gradle-setup-with-convention-plugins","pageScripts":null}},
    "staticQueryHashes": ["3406609010"]}